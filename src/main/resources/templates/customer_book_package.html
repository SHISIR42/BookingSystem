<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Book Package</title>
<link th:replace="~{fragments/navbar :: head}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    body {
        background-color: #f0f8ff;
        margin: 0;
    }
    .hero {
        background: linear-gradient(135deg, #2821a9 0%, #667eea 100%);
        color: white;
        padding: 60px 20px;
        text-align: center;
    }
    .hero h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
    }
    .container {
        max-width: 700px;
        margin: 40px auto;
        padding: 20px;
    }
    .booking-form {
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        padding: 40px;
    }
    .section-title {
        text-align: center;
        color: #2821a9;
        font-size: 2rem;
        margin-bottom: 2rem;
    }
    .form-group {
        margin-bottom: 1.5rem;
    }
    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #333;
    }
    .form-group input,
    .form-group select {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 1rem;
        box-sizing: border-box;
    }
    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: #2821a9;
        box-shadow: 0 0 0 3px rgba(40, 33, 169, 0.1);
    }
    .form-group input[readonly] {
        background-color: #f5f5f5;
    }
    .btn-submit {
        width: 100%;
        background: #c11616;
        color: white;
        padding: 15px;
        border: none;
        border-radius: 6px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 1rem;
    }
    .btn-submit:hover {
        background: #159557;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .price-display {
        background: #f0f8ff;
        padding: 15px;
        border-radius: 6px;
        border-left: 4px solid #2821a9;
        margin-top: 10px;
    }
    .price-display strong {
        color: #2821a9;
        font-size: 1.3rem;
    }
    .payment-options {
        display: flex;
        gap: 1rem;
        margin: 1.5rem 0;
    }
    .payment-option {
        flex: 1;
        text-align: center;
        padding: 1.5rem;
        border: 2px solid #ddd;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s;
        background: white;
    }
    .payment-option:hover {
        border-color: #2821a9;
        background-color: #f8f9ff;
    }
    .payment-option.selected {
        border-color: #2821a9;
        background-color: #e8f0ff;
    }
    .payment-option i {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
        color: #2821a9;
    }
    .payment-option p {
        margin: 0;
        font-weight: 600;
        color: #333;
    }
    .qr-code, .card-payment {
        display: none;
        text-align: center;
        margin: 1.5rem 0;
        padding: 1.5rem;
        background: #f8f9ff;
        border-radius: 8px;
        border: 1px solid #e0e8ff;
    }
    .qr-code img {
        max-width: 200px;
        border: 2px solid #ddd;
        padding: 1rem;
        border-radius: 8px;
        background: white;
        margin: 1rem 0;
    }
    .card-payment {
        text-align: left;
    }
    .card-icons {
        display: flex;
        gap: 0.5rem;
        margin-top: 0.5rem;
    }
    .card-icons i {
        font-size: 2rem;
        color: #555;
    }
    @media (max-width: 768px) {
        .payment-options {
            flex-direction: column;
        }
        .container {
            padding: 10px;
        }
        .booking-form {
            padding: 20px;
        }
    }
</style>
</head>
<body>
<div th:replace="~{fragments/navbar :: navigation('book-package')}"></div>

<div class="hero">
    <h1>Book Your Tickets</h1>
    <p>Complete your booking in just a few steps</p>
</div>

<div class="container">
    <div class="booking-form">
        <form th:action="@{/customer/book-package}" method="post" th:object="${booking}">
            <div class="form-group">
                <label><i class="fas fa-gift"></i> Select Package</label>
                <select id="packageSelect" onchange="updatePackageDetails()" required>
                    <option value="">Choose a package</option>
                    <option th:each="pkg : ${packages}" 
                            th:value="${pkg.pid}" 
                            th:text="${pkg.pname} + ' - $' + ${pkg.ppriced}"
                            th:attr="data-name=${pkg.pname}, data-price=${pkg.ppriced}">
                    </option>
                </select>
                <input type="hidden" th:field="*{packageId}" id="packageId">
                <input type="hidden" th:field="*{packageName}" id="packageName">
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-calendar"></i> Visit Date</label>
                <input type="date" th:field="*{bookingDate}" id="bookingDate"
                       th:value="${#temporals.format(#temporals.createToday(), 'yyyy-MM-dd')}" required>
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-user"></i> Your Name</label>
                <input type="text" th:field="*{customerName}" 
                       th:value="${user?.fname != null ? user.fname + ' ' + user.lname : ''}" 
                       placeholder="Enter your full name" required>
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-phone"></i> Phone Number</label>
                <input type="tel" th:field="*{customerPhone}" placeholder="Enter your phone number" required>
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-envelope"></i> Email Address</label>
                <input type="email" th:field="*{customerEmail}" 
                       th:value="${user?.email}" 
                       placeholder="Enter your email" required>
            </div>
            
            <div class="form-group">
                <label><i class="fas fa-dollar-sign"></i> Total Amount</label>
                <input type="number" step="0.01" th:field="*{totalAmount}" id="totalAmount" readonly required>
                <div class="price-display" id="priceInfo" style="display:none;">
                    <strong>Total: $<span id="displayPrice">0.00</span></strong>
                </div>
            </div>
            
            <h3 style="color: #2821a9; margin: 2rem 0 1rem 0;"><i class="fas fa-credit-card"></i> Payment Method</h3>
            <div class="payment-options">
                <div class="payment-option" id="qrOption">
                    <i class="fas fa-qrcode"></i>
                    <p>QR Payment</p>
                </div>
                <div class="payment-option" id="cardOption">
                    <i class="far fa-credit-card"></i>
                    <p>Card Payment</p>
                </div>
            </div>
            <input type="hidden" th:field="*{paymentMethod}" id="paymentMethod" required>
            <input type="hidden" th:field="*{transactionId}" id="transactionId">
            <input type="hidden" th:field="*{paymentStatus}" id="paymentStatus" value="Pending">
            
            <div class="qr-code" id="qrCode">
                <p style="font-weight: 600; color: #2821a9;">Scan this QR code to pay</p>
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=TravelBooking-USD-0" 
                     alt="QR Code for Payment" id="qrImage">
                <p style="margin-top: 1rem; color: #666;">After payment, you will receive confirmation via SMS/Email</p>
            </div>
            
            <div class="card-payment" id="cardPayment">
                <div class="form-group">
                    <label>Card Number</label>
                    <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19">
                    <div class="card-icons">
                        <i class="fab fa-cc-visa"></i>
                        <i class="fab fa-cc-mastercard"></i>
                        <i class="fab fa-cc-amex"></i>
                    </div>
                </div>
                
                <div style="display: flex; gap: 1rem;">
                    <div class="form-group" style="flex: 1;">
                        <label>Expiry Date</label>
                        <input type="text" id="expiry" placeholder="MM/YY" maxlength="5">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label>CVV</label>
                        <input type="text" id="cvv" placeholder="123" maxlength="3">
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Name on Card</label>
                    <input type="text" id="cardName" placeholder="Enter cardholder name">
                </div>
            </div>
            
            <button type="submit" class="btn-submit" id="submitBtn">
                <i class="fas fa-check-circle"></i> Complete Booking
            </button>
        </form>
    </div>
</div>

<script th:inline="none">
// Set minimum date to today
document.getElementById('bookingDate').min = new Date().toISOString().split('T')[0];

function updatePackageDetails() {
    const select = document.getElementById('packageSelect');
    const option = select.options[select.selectedIndex];
    
    if(select.value) {
        const price = option.getAttribute('data-price');
        document.getElementById('packageId').value = select.value;
        document.getElementById('packageName').value = option.getAttribute('data-name');
        document.getElementById('totalAmount').value = price;
        document.getElementById('displayPrice').textContent = price;
        document.getElementById('priceInfo').style.display = 'block';
        
        // Update QR code with price
        document.getElementById('qrImage').src = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=TravelBooking-USD-${price}`;
    } else {
        document.getElementById('packageId').value = '';
        document.getElementById('packageName').value = '';
        document.getElementById('totalAmount').value = '';
        document.getElementById('priceInfo').style.display = 'none';
    }
}

// Payment method selection
const qrOption = document.getElementById('qrOption');
const cardOption = document.getElementById('cardOption');
const qrCode = document.getElementById('qrCode');
const cardPayment = document.getElementById('cardPayment');

qrOption.addEventListener('click', function() {
    qrOption.classList.add('selected');
    cardOption.classList.remove('selected');
    qrCode.style.display = 'block';
    cardPayment.style.display = 'none';
    document.getElementById('paymentMethod').value = 'QR';
});

cardOption.addEventListener('click', function() {
    cardOption.classList.add('selected');
    qrOption.classList.remove('selected');
    cardPayment.style.display = 'block';
    qrCode.style.display = 'none';
    document.getElementById('paymentMethod').value = 'Card';
});

// Form validation
document.querySelector('form').addEventListener('submit', function(e) {
    const paymentMethod = document.getElementById('paymentMethod').value;
    
    if(!paymentMethod) {
        e.preventDefault();
        alert('Please select a payment method');
        return false;
    }
    
    if(paymentMethod === 'Card') {
        const cardNumber = document.getElementById('cardNumber').value;
        const expiry = document.getElementById('expiry').value;
        const cvv = document.getElementById('cvv').value;
        const cardName = document.getElementById('cardName').value;
        
        if(!cardNumber || !expiry || !cvv || !cardName) {
            e.preventDefault();
            alert('Please fill in all card details');
            return false;
        }
        
        // Generate transaction ID for card payment
        const transactionId = 'TXN' + Date.now() + Math.floor(Math.random() * 1000);
        document.getElementById('transactionId').value = transactionId;
        document.getElementById('paymentStatus').value = 'Completed';
    } else {
        // For QR payment, generate transaction ID
        const transactionId = 'QR' + Date.now() + Math.floor(Math.random() * 1000);
        document.getElementById('transactionId').value = transactionId;
        document.getElementById('paymentStatus').value = 'Pending';
    }
});
</script>
</body>
</html>
